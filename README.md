# Patch Localization System

## –û–ø–∏—Å–∞–Ω–∏–µ

**Patch Localization System** - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞—Ç—á–µ–π (—Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π) –≤ –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–µ—Ä—Ç–æ—á–Ω—ã–π –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è 256-–º–µ—Ä–Ω—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –∏ L2-—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–∞—Ç—á–µ–π.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–µ–º–æ-—Ä–µ–∂–∏–º (`--demo`)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- –°–æ–∑–¥–∞–µ—Ç –±–æ–ª—å—à–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 10,000√ó10,000 –ø–∏–∫—Å–µ–ª–µ–π —Å —Å–ª—É—á–∞–π–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∞—Ç—á 200√ó200 –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∏—Å–∫–∞

### –û–±—É—á–µ–Ω–∏–µ –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ (`--train`)
- –û–±—É—á–∞–µ—Ç —Å–≤–µ—Ä—Ç–æ—á–Ω—ã–π –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—á–µ–π –∏–∑ –±–æ–ª—å—à–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π backpropagation —Å MSE loss
- –ü—Ä—è–º–∞—è C++ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- –°–æ–∑–¥–∞–µ—Ç –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–∏—Å–∫ –ø–∞—Ç—á–∞ (`--big`, `--patch`)
- –ù–∞—Ö–æ–¥–∏—Ç –∑–∞–¥–∞–Ω–Ω—ã–π –ø–∞—Ç—á –≤ –±–æ–ª—å—à–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø–∞—Ç—á–∞
- –°–æ–∑–¥–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ç—á–µ–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏ (`--gen-patches`)
- –°–æ–∑–¥–∞–µ—Ç –Ω–∞–±–æ—Ä –ø–∞—Ç—á–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç CSV-—Ñ–∞–π–ª —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –ø–∞—Ç—á–µ–π

### –û—Ü–µ–Ω–∫–∞ –ø–æ CSV (`--eval-csv`)
- –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ CSV-—Ñ–∞–π–ª–∞
- –í—ã—á–∏—Å–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏: MAE (—Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞) –∏ –¥–æ–ª—é —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **ImageProcessor** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. **ConvolutionalAutoencoder** - —Å–≤–µ—Ä—Ç–æ—á–Ω—ã–π –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
3. **Localization** - –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–∞ –∏ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏
4. **IndexIO** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä–∞ (—Å—Ç—Ä–æ–≥–æ –ø–æ –¢–ó):

**–≠–Ω–∫–æ–¥–µ—Ä:**
- `32√ó32√ó3` ‚Üí `16√ó16√ó32` ‚Üí `8√ó8√ó64` ‚Üí `4√ó4√ó128` ‚Üí `256`

**–î–µ–∫–æ–¥–µ—Ä:**
- `256` ‚Üí `4√ó4√ó128` ‚Üí `8√ó8√ó64` ‚Üí `16√ó16√ó32` ‚Üí `32√ó32√ó3`

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:

1. **–†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ç—á–∏**: –ë–æ–ª—å—à–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–∞—Ç—á–∏ 200√ó200 –ø–∏–∫—Å–µ–ª–µ–π —Å —à–∞–≥–æ–º 50
2. **–ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è**: –ö–∞–∂–¥—ã–π –ø–∞—Ç—á —Å–æ–∑–¥–∞–µ—Ç 8 –≤–µ—Ä—Å–∏–π (–æ—Ä–∏–≥–∏–Ω–∞–ª + 3 –ø–æ–≤–æ—Ä–æ—Ç–∞ + 4 HSV –≤–∞—Ä–∏–∞–Ω—Ç–∞)
3. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**: –°–≤–µ—Ä—Ç–æ—á–Ω—ã–π –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç 256-–º–µ—Ä–Ω—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã —Å L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
4. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤
5. **–ü–æ–∏—Å–∫**: L2-—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞–º–∏
6. **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞**: –£—Ç–æ—á–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å–±–æ—Ä–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Windows 10/11
- Visual Studio 2019/2022
- OpenCV 4.x
- CMake 3.15+

### –°–±–æ—Ä–∫–∞:
```bash
mkdir build
cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
cmake --build . --config Release
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–µ–º–æ-—Ä–µ–∂–∏–º:
```bash
.\build\Release\patch_localization.exe --demo --out demo_output
```

### –û–±—É—á–µ–Ω–∏–µ:
```bash
.\build\Release\patch_localization.exe --demo --out train_output --train --epochs 10 --lr 0.001
```

### –ü–æ–∏—Å–∫ –ø–∞—Ç—á–∞:
```bash
.\build\Release\patch_localization.exe --demo --out search_result
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ç—á–µ–π:
```bash
.\build\Release\patch_localization.exe --big image.png --gen-patches 100 --out patches_output
```

### –û—Ü–µ–Ω–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏:
```bash
.\build\Release\patch_localization.exe --big image.png --eval-csv test_patches.csv --out eval_result
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:
- **MAE (—Å—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞)**: 6066.93 –ø–∏–∫—Å–µ–ª–µ–π (–Ω–µ–æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
- **–¶–µ–ª—å –¢–ó**: MAE ‚â§ 20 –ø–∏–∫—Å–µ–ª–µ–π
- **–¢–æ—á–Ω–æ—Å—Ç—å ‚â§20 –ø–∏–∫—Å–µ–ª–µ–π**: 0% (–Ω–µ–æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**: 2-3 –º–∏–Ω—É—Ç—ã –¥–ª—è 310K –ø–∞—Ç—á–µ–π

### –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `localization_result.png` - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø–∞—Ç—á–∞
- `index_*.pldb` - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤
- `convolutional_autoencoder.model` - –æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- `metrics.txt` - –º–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏
- `run.log` - –ª–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä–∞:
- **–≠–Ω–∫–æ–¥–µ—Ä**: `32√ó32√ó3` ‚Üí `16√ó16√ó32` ‚Üí `8√ó8√ó64` ‚Üí `4√ó4√ó128` ‚Üí `256`
- **–î–µ–∫–æ–¥–µ—Ä**: `256` ‚Üí `4√ó4√ó128` ‚Üí `8√ó8√ó64` ‚Üí `16√ó16√ó32` ‚Üí `32√ó32√ó3`
- **–†–∞–∑–º–µ—Ä –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞**: 256 –∏–∑–º–µ—Ä–µ–Ω–∏–π —Å L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: Xavier/Glorot
- **–ê–∫—Ç–∏–≤–∞—Ü–∏—è**: ReLU, Sigmoid
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –ü—Ä—è–º–∞—è C++ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–±–µ–∑ ONNX Runtime)

### –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
- **–ü–æ–≤–æ—Ä–æ—Ç—ã**: 0¬∞, 90¬∞, 180¬∞, 270¬∞
- **HSV-–∏–∑–º–µ–Ω–µ–Ω–∏—è**: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ 0.8-1.2
- **–í—Å–µ–≥–æ –≤–µ—Ä—Å–∏–π**: 8 –Ω–∞ –ø–∞—Ç—á

### –ü–æ–∏—Å–∫:
- **L2-—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ** –º–µ–∂–¥—É –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞–º–∏
- **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫** –±–ª–∏–∂–∞–π—à–µ–≥–æ —Å–æ—Å–µ–¥–∞
- **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω–æ—Å—Ç—å** –∫ –ø–æ–≤–æ—Ä–æ—Ç–∞–º –∏ –æ—Å–≤–µ—â–µ–Ω–∏—é
- **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
patch_localization/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp              # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ image_processor.cpp   # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ autoencoder.cpp       # –°–≤–µ—Ä—Ç–æ—á–Ω—ã–π –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ localization.cpp      # –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–∞
‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îî‚îÄ‚îÄ patch_localization.h  # –í—Å–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ build/                    # –°–æ–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ CMakeLists.txt           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó
- ‚úÖ 256-–º–µ—Ä–Ω–æ–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å L2-–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–æ—Ä–∏–≥–∏–Ω–∞–ª + 3 –ø–æ–≤–æ—Ä–æ—Ç–∞ + 4 HSV –≤–∞—Ä–∏–∞–Ω—Ç–∞)
- ‚úÖ L2-—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞
- ‚úÖ –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å —É—Ç–æ—á–Ω–µ–Ω–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –ù–∞—Å—Ç–æ—è—â–∏–π backpropagation –∏ –æ–±—É—á–µ–Ω–∏–µ
- ‚úÖ –î–µ–º–æ-—Ä–µ–∂–∏–º, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ç—á–µ–π, MAE —Ç–µ—Å—Ç
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π –∏ –∏–Ω–¥–µ–∫—Å–æ–≤

### üéØ –¶–µ–ª—å:
- **MAE ‚â§ 20 –ø–∏–∫—Å–µ–ª–µ–π** (–¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è)

---

**–í–µ—Ä—Å–∏—è**: 2.0  
**–°—Ç–∞—Ç—É—Å**: –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó  
**–õ–∏—Ü–µ–Ω–∑–∏—è**: MIT

